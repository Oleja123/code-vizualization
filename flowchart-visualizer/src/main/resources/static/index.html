<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–í–∏–∑—É–∞–ª–∏–∑–∞—Ç–æ—Ä –±–ª–æ–∫-—Å—Ö–µ–º –ø–æ –ì–û–°–¢</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }
        
        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }
        
        .content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            padding: 30px;
        }
        
        .panel {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 20px;
        }
        
        .panel h2 {
            color: #333;
            margin-bottom: 15px;
            font-size: 1.5em;
        }
        
        textarea {
            width: 100%;
            min-height: 400px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 6px;
            resize: vertical;
            background: white;
        }
        
        textarea:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .button-group {
            margin-top: 15px;
            display: flex;
            gap: 10px;
        }
        
        button {
            flex: 1;
            padding: 12px 24px;
            font-size: 16px;
            font-weight: 600;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }
        
        .btn-secondary {
            background: #6c757d;
            color: white;
        }
        
        .btn-secondary:hover {
            background: #5a6268;
        }
        
        #svgOutput {
            width: 100%;
            min-height: 400px;
            border: 2px solid #ddd;
            border-radius: 6px;
            background: white;
            overflow: auto;
        }
        
        #svgOutput svg {
            width: 100%;
            height: auto;
        }
        
        .status {
            margin-top: 15px;
            padding: 12px;
            border-radius: 6px;
            font-size: 14px;
            display: none;
        }
        
        .status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .loading {
            display: none;
            text-align: center;
            padding: 20px;
        }
        
        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è –ø–æ–¥—Å–≤–µ—Ç–∫–∏ –±–ª–æ–∫–æ–≤ (–¥–ª—è –±—É–¥—É—â–µ–π —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∏) */
        .flowchart-node {
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .flowchart-node:hover {
            filter: brightness(0.9);
        }
        
        .flowchart-node.active {
            fill: #ffeb3b !important;
            stroke: #f57c00 !important;
            stroke-width: 3 !important;
        }
    </style>
</head>
<body>
<div class="container">
    <div class="header">
        <h1>üî∑ –í–∏–∑—É–∞–ª–∏–∑–∞—Ç–æ—Ä –±–ª–æ–∫-—Å—Ö–µ–º</h1>
        <p>–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –±–ª–æ–∫-—Å—Ö–µ–º –ø–æ –ì–û–°–¢ 19.701-90 –∏–∑ AST</p>
    </div>

    <div class="content">
        <!-- –ü–∞–Ω–µ–ª—å –≤–≤–æ–¥–∞ AST -->
        <div class="panel">
            <h2>üìù AST (JSON)</h2>
            <textarea id="astInput" placeholder='–í—Å—Ç–∞–≤—å—Ç–µ JSON AST –æ—Ç Go —Å–µ—Ä–≤–∏—Å–∞...
–ü—Ä–∏–º–µ—Ä:
{
  "type": "Program",
  "declarations": [...]
}'></textarea>

            <div class="button-group">
                <button class="btn-primary" onclick="generateFlowchart()">
                    üöÄ –°–æ–∑–¥–∞—Ç—å –±–ª–æ–∫-—Å—Ö–µ–º—É
                </button>
            </div>

            <div class="button-group">
                <select id="exampleSelector" style="flex: 2; padding: 12px; border-radius: 6px; border: 2px solid #ddd; font-size: 14px;">
                    <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–∏–º–µ—Ä...</option>
                    <option value="simple-if">–ü—Ä–∏–º–µ—Ä 1: –ü—Ä–æ—Å—Ç–æ–µ if/else</option>
                    <option value="while-loop">–ü—Ä–∏–º–µ—Ä 2: –¶–∏–∫–ª while</option>
                    <option value="for-loop">–ü—Ä–∏–º–µ—Ä 3: –¶–∏–∫–ª for</option>
                    <option value="complex">–ü—Ä–∏–º–µ—Ä 4: –°–ª–æ–∂–Ω–∞—è –ø—Ä–æ–≥—Ä–∞–º–º–∞</option>
                </select>
                <button class="btn-secondary" onclick="loadSelectedExample()" style="flex: 1;">
                    üìÑ –ó–∞–≥—Ä—É–∑–∏—Ç—å
                </button>
            </div>

            <div id="status" class="status"></div>
        </div>

        <!-- –ü–∞–Ω–µ–ª—å –≤—ã–≤–æ–¥–∞ SVG -->
        <div class="panel">
            <h2>üìä –ë–ª–æ–∫-—Å—Ö–µ–º–∞</h2>
            <div id="svgOutput">
                <div style="display: flex; align-items: center; justify-content: center; height: 400px; color: #999;">
                    –ó–¥–µ—Å—å –ø–æ—è–≤–∏—Ç—Å—è –±–ª–æ–∫-—Å—Ö–µ–º–∞
                </div>
            </div>

            <div class="button-group">
                <button class="btn-secondary" onclick="downloadSVG()">
                    üíæ –°–∫–∞—á–∞—Ç—å SVG
                </button>
            </div>

            <div class="loading" id="loading">
                <div class="spinner"></div>
                <p>–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –±–ª–æ–∫-—Å—Ö–µ–º—ã...</p>
            </div>
        </div>
    </div>
</div>

<script>
    const API_URL = 'http://localhost:8081/api/flowchart';

    // –ü—Ä–∏–º–µ—Ä AST –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏
    const EXAMPLE_SIMPLE_IF = {
        "type": "Program",
        "declarations": [
            {
                "type": "FunctionDecl",
                "name": "main",
                "returnType": {
                    "baseType": "int",
                    "pointerLevel": 0,
                    "arraySizes": []
                },
                "parameters": [],
                "body": {
                    "type": "BlockStmt",
                    "statements": [
                        {
                            "type": "VariableDecl",
                            "varType": {
                                "baseType": "int",
                                "pointerLevel": 0,
                                "arraySizes": []
                            },
                            "name": "x",
                            "initExpr": {
                                "type": "IntLiteral",
                                "value": 10,
                                "location": {"line": 2, "column": 13, "endLine": 2, "endColumn": 15}
                            },
                            "location": {"line": 2, "column": 5, "endLine": 2, "endColumn": 16}
                        },
                        {
                            "type": "WhileStmt",
                            "condition": {
                                "type": "BinaryExpr",
                                "op": ">",
                                "left": {
                                    "type": "VariableExpr",
                                    "name": "x",
                                    "location": {"line": 3, "column": 12, "endLine": 3, "endColumn": 13}
                                },
                                "right": {
                                    "type": "IntLiteral",
                                    "value": 0,
                                    "location": {"line": 3, "column": 16, "endLine": 3, "endColumn": 17}
                                },
                                "location": {"line": 3, "column": 12, "endLine": 3, "endColumn": 17}
                            },
                            "body": {
                                "type": "BlockStmt",
                                "statements": [
                                    {
                                        "type": "ExprStmt",
                                        "expression": {
                                            "type": "AssignmentExpr",
                                            "op": "=",
                                            "left": {
                                                "type": "VariableExpr",
                                                "name": "x",
                                                "location": {"line": 4, "column": 9, "endLine": 4, "endColumn": 10}
                                            },
                                            "right": {
                                                "type": "BinaryExpr",
                                                "op": "-",
                                                "left": {
                                                    "type": "VariableExpr",
                                                    "name": "x",
                                                    "location": {"line": 4, "column": 13, "endLine": 4, "endColumn": 14}
                                                },
                                                "right": {
                                                    "type": "IntLiteral",
                                                    "value": 1,
                                                    "location": {"line": 4, "column": 17, "endLine": 4, "endColumn": 18}
                                                },
                                                "location": {"line": 4, "column": 13, "endLine": 4, "endColumn": 18}
                                            },
                                            "location": {"line": 4, "column": 9, "endLine": 4, "endColumn": 18}
                                        },
                                        "location": {"line": 4, "column": 9, "endLine": 4, "endColumn": 19}
                                    }
                                ],
                                "location": {"line": 3, "column": 19, "endLine": 5, "endColumn": 6}
                            },
                            "location": {"line": 3, "column": 5, "endLine": 5, "endColumn": 6}
                        },
                        {
                            "type": "ReturnStmt",
                            "value": {
                                "type": "IntLiteral",
                                "value": 0,
                                "location": {"line": 6, "column": 12, "endLine": 6, "endColumn": 13}
                            },
                            "location": {"line": 6, "column": 5, "endLine": 6, "endColumn": 14}
                        }
                    ],
                    "location": {"line": 1, "column": 16, "endLine": 7, "endColumn": 2}
                },
                "location": {"line": 1, "column": 1, "endLine": 7, "endColumn": 2}
            }
        ],
        "location": {"line": 1, "column": 1, "endLine": 7, "endColumn": 2}
    };

    const EXAMPLE_WHILE_LOOP = {
        "type": "Program",
        "declarations": [{
            "type": "FunctionDecl",
            "name": "main",
            "returnType": {"baseType": "int", "pointerLevel": 0, "arraySizes": []},
            "parameters": [],
            "body": {
                "type": "BlockStmt",
                "statements": [
                    {
                        "type": "VariableDecl",
                        "varType": {"baseType": "int", "pointerLevel": 0, "arraySizes": []},
                        "name": "x",
                        "initExpr": {"type": "IntLiteral", "value": 10, "location": {"line": 2, "column": 13, "endLine": 2, "endColumn": 15}},
                        "location": {"line": 2, "column": 5, "endLine": 2, "endColumn": 16}
                    },
                    {
                        "type": "WhileStmt",
                        "condition": {
                            "type": "BinaryExpr",
                            "op": ">",
                            "left": {"type": "VariableExpr", "name": "x", "location": {"line": 3, "column": 12, "endLine": 3, "endColumn": 13}},
                            "right": {"type": "IntLiteral", "value": 0, "location": {"line": 3, "column": 16, "endLine": 3, "endColumn": 17}},
                            "location": {"line": 3, "column": 12, "endLine": 3, "endColumn": 17}
                        },
                        "body": {
                            "type": "BlockStmt",
                            "statements": [{
                                "type": "ExprStmt",
                                "expression": {
                                    "type": "AssignmentExpr",
                                    "op": "=",
                                    "left": {"type": "VariableExpr", "name": "x", "location": {"line": 4, "column": 9, "endLine": 4, "endColumn": 10}},
                                    "right": {
                                        "type": "BinaryExpr",
                                        "op": "-",
                                        "left": {"type": "VariableExpr", "name": "x", "location": {"line": 4, "column": 13, "endLine": 4, "endColumn": 14}},
                                        "right": {"type": "IntLiteral", "value": 1, "location": {"line": 4, "column": 17, "endLine": 4, "endColumn": 18}},
                                        "location": {"line": 4, "column": 13, "endLine": 4, "endColumn": 18}
                                    },
                                    "location": {"line": 4, "column": 9, "endLine": 4, "endColumn": 18}
                                },
                                "location": {"line": 4, "column": 9, "endLine": 4, "endColumn": 19}
                            }],
                            "location": {"line": 3, "column": 19, "endLine": 5, "endColumn": 6}
                        },
                        "location": {"line": 3, "column": 5, "endLine": 5, "endColumn": 6}
                    },
                    {
                        "type": "ReturnStmt",
                        "value": {"type": "IntLiteral", "value": 0, "location": {"line": 6, "column": 12, "endLine": 6, "endColumn": 13}},
                        "location": {"line": 6, "column": 5, "endLine": 6, "endColumn": 14}
                    }
                ],
                "location": {"line": 1, "column": 16, "endLine": 7, "endColumn": 2}
            },
            "location": {"line": 1, "column": 1, "endLine": 7, "endColumn": 2}
        }],
        "location": {"line": 1, "column": 1, "endLine": 7, "endColumn": 2}
    };

    const EXAMPLE_FOR_LOOP = {
        "type": "Program",
        "declarations": [{
            "type": "FunctionDecl",
            "name": "main",
            "returnType": {"baseType": "int", "pointerLevel": 0, "arraySizes": []},
            "parameters": [],
            "body": {
                "type": "BlockStmt",
                "statements": [
                    {
                        "type": "VariableDecl",
                        "varType": {"baseType": "int", "pointerLevel": 0, "arraySizes": []},
                        "name": "sum",
                        "initExpr": {"type": "IntLiteral", "value": 0, "location": {"line": 2, "column": 15, "endLine": 2, "endColumn": 16}},
                        "location": {"line": 2, "column": 5, "endLine": 2, "endColumn": 17}
                    },
                    {
                        "type": "ForStmt",
                        "init": {
                            "type": "VariableDecl",
                            "varType": {"baseType": "int", "pointerLevel": 0, "arraySizes": []},
                            "name": "i",
                            "initExpr": {"type": "IntLiteral", "value": 0, "location": {"line": 3, "column": 18, "endLine": 3, "endColumn": 19}},
                            "location": {"line": 3, "column": 10, "endLine": 3, "endColumn": 19}
                        },
                        "condition": {
                            "type": "BinaryExpr",
                            "op": "<",
                            "left": {"type": "VariableExpr", "name": "i", "location": {"line": 3, "column": 21, "endLine": 3, "endColumn": 22}},
                            "right": {"type": "IntLiteral", "value": 5, "location": {"line": 3, "column": 25, "endLine": 3, "endColumn": 26}},
                            "location": {"line": 3, "column": 21, "endLine": 3, "endColumn": 26}
                        },
                        "post": {
                            "type": "ExprStmt",
                            "expression": {
                                "type": "UnaryExpr",
                                "op": "++",
                                "operand": {"type": "VariableExpr", "name": "i", "location": {"line": 3, "column": 28, "endLine": 3, "endColumn": 29}},
                                "location": {"line": 3, "column": 28, "endLine": 3, "endColumn": 31}
                            },
                            "location": {"line": 3, "column": 28, "endLine": 3, "endColumn": 31}
                        },
                        "body": {
                            "type": "BlockStmt",
                            "statements": [{
                                "type": "ExprStmt",
                                "expression": {
                                    "type": "AssignmentExpr",
                                    "op": "+=",
                                    "left": {"type": "VariableExpr", "name": "sum", "location": {"line": 4, "column": 9, "endLine": 4, "endColumn": 12}},
                                    "right": {"type": "VariableExpr", "name": "i", "location": {"line": 4, "column": 16, "endLine": 4, "endColumn": 17}},
                                    "location": {"line": 4, "column": 9, "endLine": 4, "endColumn": 17}
                                },
                                "location": {"line": 4, "column": 9, "endLine": 4, "endColumn": 18}
                            }],
                            "location": {"line": 3, "column": 33, "endLine": 5, "endColumn": 6}
                        },
                        "location": {"line": 3, "column": 5, "endLine": 5, "endColumn": 6}
                    },
                    {
                        "type": "ReturnStmt",
                        "value": {"type": "VariableExpr", "name": "sum", "location": {"line": 6, "column": 12, "endLine": 6, "endColumn": 15}},
                        "location": {"line": 6, "column": 5, "endLine": 6, "endColumn": 16}
                    }
                ],
                "location": {"line": 1, "column": 16, "endLine": 7, "endColumn": 2}
            },
            "location": {"line": 1, "column": 1, "endLine": 7, "endColumn": 2}
        }],
        "location": {"line": 1, "column": 1, "endLine": 7, "endColumn": 2}
    };

    const EXAMPLE_COMPLEX = {
        "type": "Program",
        "declarations": [{
            "type": "FunctionDecl",
            "name": "main",
            "returnType": {"baseType": "int", "pointerLevel": 0, "arraySizes": []},
            "parameters": [],
            "body": {
                "type": "BlockStmt",
                "statements": [
                    {
                        "type": "VariableDecl",
                        "varType": {"baseType": "int", "pointerLevel": 0, "arraySizes": []},
                        "name": "n",
                        "initExpr": {"type": "IntLiteral", "value": 15, "location": {"line": 2, "column": 13, "endLine": 2, "endColumn": 15}},
                        "location": {"line": 2, "column": 5, "endLine": 2, "endColumn": 16}
                    },
                    {
                        "type": "IfStmt",
                        "condition": {
                            "type": "BinaryExpr",
                            "op": "%",
                            "left": {"type": "VariableExpr", "name": "n", "location": {"line": 3, "column": 9, "endLine": 3, "endColumn": 10}},
                            "right": {"type": "IntLiteral", "value": 2, "location": {"line": 3, "column": 13, "endLine": 3, "endColumn": 14}},
                            "location": {"line": 3, "column": 9, "endLine": 3, "endColumn": 14}
                        },
                        "thenBlock": {
                            "type": "ReturnStmt",
                            "value": {"type": "IntLiteral", "value": 1, "location": {"line": 3, "column": 24, "endLine": 3, "endColumn": 25}},
                            "location": {"line": 3, "column": 17, "endLine": 3, "endColumn": 26}
                        },
                        "elseIfList": [
                            {
                                "condition": {
                                    "type": "BinaryExpr",
                                    "op": "%",
                                    "left": {"type": "VariableExpr", "name": "n", "location": {"line": 3, "column": 41, "endLine": 3, "endColumn": 42}},
                                    "right": {"type": "IntLiteral", "value": 3, "location": {"line": 3, "column": 45, "endLine": 3, "endColumn": 46}},
                                    "location": {"line": 3, "column": 41, "endLine": 3, "endColumn": 46}
                                },
                                "block": {
                                    "type": "ReturnStmt",
                                    "value": {"type": "IntLiteral", "value": 2, "location": {"line": 3, "column": 56, "endLine": 3, "endColumn": 57}},
                                    "location": {"line": 3, "column": 49, "endLine": 3, "endColumn": 58}
                                },
                                "location": {"line": 3, "column": 32, "endLine": 3, "endColumn": 58}
                            }
                        ],
                        "elseBlock": {
                            "type": "ReturnStmt",
                            "value": {"type": "IntLiteral", "value": 0, "location": {"line": 3, "column": 72, "endLine": 3, "endColumn": 73}},
                            "location": {"line": 3, "column": 65, "endLine": 3, "endColumn": 74}
                        },
                        "location": {"line": 3, "column": 5, "endLine": 3, "endColumn": 74}
                    }
                ],
                "location": {"line": 1, "column": 16, "endLine": 4, "endColumn": 2}
            },
            "location": {"line": 1, "column": 1, "endLine": 4, "endColumn": 2}
        }],
        "location": {"line": 1, "column": 1, "endLine": 4, "endColumn": 2}
    };

    // –ó–∞–≥—Ä—É–∑–∏—Ç—å –≤—ã–±—Ä–∞–Ω–Ω—ã–π –ø—Ä–∏–º–µ—Ä
    function loadSelectedExample() {
        const selector = document.getElementById('exampleSelector');
        const selected = selector.value;

        let example = null;
        switch(selected) {
            case 'simple-if':
                example = EXAMPLE_SIMPLE_IF;
                break;
            case 'while-loop':
                example = EXAMPLE_WHILE_LOOP;
                break;
            case 'for-loop':
                example = EXAMPLE_FOR_LOOP;
                break;
            case 'complex':
                example = EXAMPLE_COMPLEX;
                break;
            default:
                showStatus('–í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–∏–º–µ—Ä –∏–∑ —Å–ø–∏—Å–∫–∞', 'error');
                return;
        }

        if (example) {
            document.getElementById('astInput').value = JSON.stringify(example, null, 2);
            showStatus('‚úì –ü—Ä–∏–º–µ—Ä –∑–∞–≥—Ä—É–∂–µ–Ω!', 'success');
        }
    }

    // –°—Ç–∞—Ä–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±—Ä–∞—Ç–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏
    function loadExample() {
        document.getElementById('exampleSelector').value = 'while-loop';
        loadSelectedExample();
    }

    // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –±–ª–æ–∫-—Å—Ö–µ–º—ã
    async function generateFlowchart() {
        const astInput = document.getElementById('astInput').value.trim();

        if (!astInput) {
            showStatus('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ JSON AST', 'error');
            return;
        }

        // –ü–∞—Ä—Å–∏–º JSON
        let ast;
        try {
            ast = JSON.parse(astInput);
        } catch (e) {
            showStatus('–û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ JSON: ' + e.message, 'error');
            return;
        }

        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É
        document.getElementById('loading').style.display = 'block';
        document.getElementById('svgOutput').innerHTML = '';
        hideStatus();

        try {
            // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å –∫ API
            const response = await fetch(`${API_URL}/generate`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ ast: ast })
            });

            const data = await response.json();

            if (data.metadata && data.metadata.success) {
                // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º SVG
                document.getElementById('svgOutput').innerHTML = data.svg;
                showStatus('‚úì –ë–ª–æ–∫-—Å—Ö–µ–º–∞ —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω–∞!', 'success');

                // –î–æ–±–∞–≤–ª—è–µ–º –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å (–¥–ª—è –±—É–¥—É—â–µ–π —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∏)
                addInteractivity();
            } else {
                showStatus('–û—à–∏–±–∫–∞: ' + (data.metadata.error || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'), 'error');
            }
        } catch (e) {
            showStatus('–û—à–∏–±–∫–∞ —Å–≤—è–∑–∏ —Å —Å–µ—Ä–≤–µ—Ä–æ–º: ' + e.message +
                '\n\n–ü—Ä–æ–≤–µ—Ä—å—Ç–µ:\n1. –°–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω (mvn spring-boot:run)\n2. –î–æ—Å—Ç—É–ø–µ–Ω http://localhost:8081', 'error');
            console.error('–î–µ—Ç–∞–ª–∏ –æ—à–∏–±–∫–∏:', e);
        } finally {
            document.getElementById('loading').style.display = 'none';
        }
    }

    // –î–æ–±–∞–≤–∏—Ç—å –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –∫ SVG –±–ª–æ–∫–∞–º
    function addInteractivity() {
        const svg = document.querySelector('#svgOutput svg');
        if (!svg) return;

        // –ù–∞—Ö–æ–¥–∏–º –≤—Å–µ –≥—Ä—É–ø–ø—ã (–±–ª–æ–∫–∏)
        const groups = svg.querySelectorAll('g[id]');
        groups.forEach(group => {
            group.classList.add('flowchart-node');

            // –ü—Ä–∏ –∫–ª–∏–∫–µ - –ø–æ–¥—Å–≤–µ—Ç–∫–∞ (–¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è –±—É–¥—É—â–µ–π —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∏)
            group.addEventListener('click', function() {
                // –£–±–∏—Ä–∞–µ–º –ø–æ–¥—Å–≤–µ—Ç–∫—É —Å–æ –≤—Å–µ—Ö
                groups.forEach(g => g.classList.remove('active'));
                // –ü–æ–¥—Å–≤–µ—á–∏–≤–∞–µ–º —Ç–µ–∫—É—â–∏–π
                this.classList.add('active');

                console.log('Clicked node:', this.id);
            });
        });
    }

    // –°–∫–∞—á–∞—Ç—å SVG
    function downloadSVG() {
        const svgElement = document.querySelector('#svgOutput svg');
        if (!svgElement) {
            showStatus('–°–Ω–∞—á–∞–ª–∞ —Å–æ–∑–¥–∞–π—Ç–µ –±–ª–æ–∫-—Å—Ö–µ–º—É', 'error');
            return;
        }

        const svgData = new XMLSerializer().serializeToString(svgElement);
        const blob = new Blob([svgData], { type: 'image/svg+xml' });
        const url = URL.createObjectURL(blob);

        const a = document.createElement('a');
        a.href = url;
        a.download = 'flowchart.svg';
        a.click();

        URL.revokeObjectURL(url);
        showStatus('‚úì SVG —Å–∫–∞—á–∞–Ω!', 'success');
    }

    // –ü–æ–∫–∞–∑–∞—Ç—å —Å—Ç–∞—Ç—É—Å
    function showStatus(message, type) {
        const status = document.getElementById('status');
        status.textContent = message;
        status.className = 'status ' + type;
        status.style.display = 'block';
    }

    // –°–∫—Ä—ã—Ç—å —Å—Ç–∞—Ç—É—Å
    function hideStatus() {
        document.getElementById('status').style.display = 'none';
    }

    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ API –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
    window.addEventListener('load', async () => {
        try {
            const response = await fetch(`${API_URL}/health`);
            const data = await response.json();
            console.log('API Health:', data);
        } catch (e) {
            console.warn('API not available:', e);
        }
    });
</script>
</body>
</html>